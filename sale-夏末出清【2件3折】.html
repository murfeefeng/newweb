<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>PolyLulu</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="../Source/css/zh-cht/vendor/animate.css?20201012" rel="stylesheet" />
    <link href="../Source/css/zh-cht/fonts/fontawesome/all.min.css" rel="stylesheet" />
    <link href="../Source/css/zh-cht/fonts/icomoon/icons.css?20201012" rel="stylesheet" />
    <link href="../Source/css/zh-cht/vendor/slick.css" rel="stylesheet" />
    <link href="../Source/css/zh-cht/vendor/slick-theme.css" rel="stylesheet" />
    <link href="../Source/css/zh-cht/vendor/magnific-popup.css?20201012" rel="stylesheet" />
    <link href="../Source/css/zh-cht/main.css?20201012" rel="stylesheet" />
    <script src="../Source/js/zh-cht/vendor/jquery-3.3.1.min.js?20190506"></script>
</head>

<body class="body_white" data-eventID="">


    <!-- Main Content op -->
    <div id="mainArea" class="pageIn pageProductList">
        <div id="main-content" class="main">
            <div id="sidebar" class="sidebar navLeft">
                <div class="sidebar__inner">
                    <ul>
                        <li>
                            <a title="" href="">新品上市</a>
                            <div class="menu_in">
                                <a title="" href="productlist.html">▸ 本週新品</a>
                                <a title="" href="productlist.html">▸ 0429上市新品</a>
                                <a title="" href="productlist.html">▸ 0422上市新品</a>
                                <a title="" href="productlist.html">▸ 0415上市新品</a>
                                <a title="" href="productlist.html">▸ 全館商品</a>
                            </div>
                        </li>

                    </ul>
                </div>
            </div>
            <div id="content" class="content areaRight">
                <div id="saleEVENTall">
                    <style>
                        #saleEVENTall>div {
                            position: relative;
                            width: 100%;
                            /* display: contents; */
                            box-sizing: border-box;
                        }

                        #saleEVENTall>div>.links.right {
                            position: absolute;
                            top: 20%;
                            right: 0;
                            width: 18%;
                            height: 70%;
                            display: flex;
                            flex-direction: column;
                            flex-grow: 1;

                        }

                        #saleEVENTall>div>.links.right a {
                            display: block;
                            width: 100%;
                            height: 30%;
                        }

                        #saleEVENTall>div>.links.md {
                            position: absolute;
                            top: 0;
                            width: 100%;
                            height: 77%;
                            display: flex;
                            flex-direction: row;
                            width: 100%;
                        }

                        #saleEVENTall>div>.links.md a {
                            flex-grow: 1;
                        }

                        #saleEVENTall>div>.links.bt {
                            position: absolute;
                            width: 100%;
                            height: 10%;
                            right: inherit;
                            bottom: 12%;
                            display: flex;
                            flex-direction: row;
                            width: 100%;
                        }

                        #saleEVENTall>div>.links.bt a {
                            flex-grow: 1;

                        }

                        #saleEVENTall>div>.links.bt a:first-child {
                            flex-basis: 4%;
                        }

                        @media (max-width: 575px) {

                            #saleEVENTall>div {
                                position: relative;
                            }



                            #saleEVENTall>div>.links.md>a {
                                position: absolute;
                                width: 100%;
                                display: block;
                            }

                            #saleEVENTall>div>.links.md a:nth-child(1) {
                                top: 0;
                                left: 0;
                                height: 114vw;
                            }

                            #saleEVENTall>div>.links.md a:nth-child(2) {
                                top: 188vw;
                                left: 0;
                                height: 44vw;
                            }

                            #saleEVENTall>div>.links.md a:nth-child(3) {
                                top: 233vw;
                                left: 0;
                                height: 44vw;
                            }

                            #saleEVENTall>div>.links.bt {
                                flex-wrap: wrap;
                                top: 120vw;
                                bottom: inherit;
                                height: 62vw;

                            }

                            #saleEVENTall>div>.links.bt a {
                                flex-grow: 1;
                                flex-basis: 33.3333% !important;

                            }

                        }
                    </style>
                    <div>
                        <div class="showPC">
                            <!-- <a href="" name="scrollTOPTOP" id="scrollTOPTOP"></a> -->
                            <img alt="2件3折"
                                src="http://photo.polylulu.com.tw/photo/act/salebn/20220921/saleSummer-2for30-pc-01.jpg">

                        </div>
                        <div class="showM">
                            <!-- <a href="" name="scrollTOPTOP" id="scrollTOPTOP"></a> -->
                            <img alt="2件3折"
                                src="http://photo.polylulu.com.tw/photo/act/salebn/20220921/saleSummer-2for30-m-01.jpg">

                        </div>
                        <div class="links md">
                            <a title="2件3折"
                                href="https://www.polylulu.com.tw/productsale?KeyWord=pi:6599299701&actno=8669F134-296E-46A1-9402-FC2BC216B442"></a>
                            <a href="https://www.polylulu.com.tw/productsale?KeyWord=pi:6599298101&actno=C362FAF3-8810-4295-8493-700F67BA0829"
                                title="2件45折"></a>
                            <a href="https://www.polylulu.com.tw/productsale?KeyWord=pi:6599296401&actno=BD13D177-3C90-427D-883C-96E85F0E3808"
                                title="2件75折"></a>
                        </div>
                        <div class="links bt">
                            <a title="2件3折全館商品"
                                href="https://www.polylulu.com.tw/productsale?KeyWord=pi:6599299701&actno=8669F134-296E-46A1-9402-FC2BC216B442"></a>
                            <a title="2件3折上衣"
                                href="https://www.polylulu.com.tw/productsale?KeyWord=pi:6599299801&actno=A073A973-3606-40F0-8F6D-B411A09F4120"></a>
                            <a title="2件3折洋裝"
                                href="https://www.polylulu.com.tw/productsale?KeyWord=pi:6599299901&actno=7B180020-FB78-4F11-B56E-34CDCA1C4002"></a>
                            <a title="2件3折外套"
                                href="https://www.polylulu.com.tw/productsale?KeyWord=pi:6599300001&actno=3C2EC967-4DE0-4C7B-A518-8E7DBD72DECF"></a>
                            <a title="2件3折褲子"
                                href="https://www.polylulu.com.tw/productsale?KeyWord=pi:6599300101&actno=2259E6ED-998D-4707-A3BD-08663BCF4BEB"></a>
                            <a title="2件3折裙子"
                                href="https://www.polylulu.com.tw/productsale?KeyWord=pi:6599300201&actno=0275C6DF-B968-452B-865F-B3AE99872A33"></a>
                        </div>
                    </div>


                </div>


                <!-- <div id="ABC">123</div> -->
            </div>
        </div>
    </div>


    <!-- Main Content op -->



</body>
<script src="../Source/js/zh-cht/vendor/jquery-2.2.0.min.js " type="text/javascript "></script>
<script src="../Source/js/zh-cht/vendor/popper.min.js?20190506 "></script>
<script src="../Source/js/zh-cht/vendor/bootstrap.min.js?20190506 "></script>
<script src="../Source/js/zh-cht/vendor/jquery.min.js?20190506 "></script>
<script src="../Source/js/zh-cht/vendor/bootstrap.bundle.min.js "></script>
<script src="../Source/js/zh-cht/vendor/wow.min.js?20190506 "></script>
<script src="../Source/js/zh-cht/vendor/slick.js "></script>
<script src="../Source/js/zh-cht/vendor/jquery.bootstrap-touchspin.min.js "></script>
<script src="../Source/js/zh-cht/vendor/jquery.magnific-popup.min.js "></script>
<script src="../Source/js/zh-cht/vendor/sticky-sidebar.min.js "></script>
<script src="../Source/js/zh-cht/main.js "></script>
<script type="text/javascript ">
    new WOW().init();

    //選取數量的套件
    $("input[name='demo0'] ").TouchSpin();


    //----
    var sidebar = new StickySidebar('#sidebar', { // 要固定的側邊欄
        containerSelector: '#main-content', // 側邊欄外面的區塊
        innerWrapperSelector: '.sidebar__inner',
        topSpacing: 20, // 距離頂部 20px，可理解成 padding-top:20px
        bottomSpacing: 20 // 距離底部 20px，可理解成 padding-bottom:20px
    });


    //根據JSON資料抓優惠活動
    $.getJSON("sale.json ", function(storeArray) {

        var arr = storeArray.Result;
        var discountOFF = arr.YAGDC;
        var discountCOMBO = arr.comboNum;
        var allList = arr.ProductList;
        var eventNUM = arr.Item1; //優惠活動編號

        var eventID = $('body').attr('data-eventID', eventNUM);

        if ($('body').attr('data-eventID') == eventNUM) {
            // alert("456");
            var cartListOLD = localStorage.getItem(eventNUM);
            $('#saleCartList').html(cartListOLD);
            //抓清單中UL的CLASS名稱
            var cartListArr = [];

            for (let u = 1; u < $('#saleCartList ul').length; u++) {
                const listUL = $('#saleCartList ul').eq(u).attr('class');

                cartListArr.push(listUL);

            }
            console.log(cartListArr);

            //找出option幫他加class
            for (let o = 0; o < cartListArr.length; o++) {
                const optlist = cartListArr[o];
                alert(optlist);

                const optVAl = $('#pdSaleList').find('option');
                for (let p = 0; p < optVAl.length; p++) {
                    const oppp = optVAl.eq(p).val();

                    if (optlist == oppp) {
                        alert(oppp);
                    }

                }

            }




            $('.saleSelect').find('option').val();

            //選購按鈕變成選取中
            // $('.sel' + selDelBox).parent('.saleSelect').siblings('.saleBtn').children('input').prop("checked", false);
            //選購按鈕變成已選購樣式
            // $('.sel' + selDelBox).parent('.saleSelect').siblings('.saleBtn').children('label').html('<span>+ 選購</span>');
            //option 加上 class
            // $('.sel' + selDelBox).attr('class', '');
        }
        // else {
        //     const cartHTMLorg = `<ul class="item_tit_pc">
        //                 <li class="item_pic">商品明細</li>
        //                 <li class="item_info"></li>
        //                 <li class="item_qty">數量</li>
        //                 <li class="item_price">原價</li>
        //                 <li class="item_price_sub">活動價</li>
        //                 <li class="item_btn"><span>刪除</span></li>
        //             </ul>`;
        //     $('#saleCartList').appand(cartHTMLorg);
        // }


        var saleListDATA = []; //data

        //印出商品列表
        allList.forEach(item => {
            const saleListHTML = `<li>
                                <small class="item_info_id" style="display:none;"><span class="pd_saleinfo">` + item.OnSale + `</span><span class="pd_ID"> ` + item.ProductID + `</span></small>
                                <figure>
                                    <a title="" href="product.html">
                                        <img src="` + item.PhotoInfo.url + `" alt=" " title="">
                                        <figcaption>
                                            <div class="pd_name">` + item.ProductTitle + `</div><span class="price-old ">NT.` + item.OriginalPrice + `</span><span class="price-sale">NTD.` + Math.round(item.OriginalPrice * (discountOFF / 100)) + `</span>
                                        </figcaption>
                                    </a>
                                    <div class="saleSELBox">
                                        <select name="" class="saleSelect" id="sel_` + item.ColorID + `">
											<option value="noSel">顏色 / 尺寸</option>
										</select>
                                        <div class="btn saleBtn"><input type="checkbox" name="` + item.ColorID + `" id="` + item.ColorID + `" value=" ">
                                            <label for="` + item.ColorID + `">+ 選購</label>
                                        </div>
                                    </div>
                                </figure>
                            </li>`;
            $('#pdSaleList').append(saleListHTML);
            var sizeList = item.SizeInfoList;
            var colorNUM = item.ColorID;
            var colorNAME = item.ColorName;
            // console.log(colorNUM);
            sizeList.forEach(size => {
                const sizeOption = `<option value="` + colorNUM + `-` + size.SizeID + `" data-color="` + colorNAME + `" data-size="L">` + colorNAME + ` / ` + size.SizeID + `</option>`;
                $('#sel_' + colorNUM).append(sizeOption);
            });

        });


        //選取尺寸
        $('.saleSelect').on('change', function() {
            const selVal = $(this).children('option:selected').val();
            if ($(this).children('option:selected').hasClass('sel' + selVal)) {
                const selBTN = '<span><i class="icon"> <u class="icon-i_okay"></u></i>已選購</span>';
                $(this).siblings('.saleBtn').children('input').prop("checked", true);
                $(this).siblings('.saleBtn').children('label').html(selBTN);
            } else {
                $(this).siblings('.saleBtn').children('input').prop("checked", false);
                $(this).siblings('.saleBtn').children('label').html('<span>+ 選購</span>');
            }
            //判斷選取的項目是否已選購

        })

        //確認選購
        $('.saleBtn input').on('change', function() {

            // var total = 0;
            const selVal = $(this).parents('.saleBtn').siblings('.saleSelect').children('option:selected').val();
            const selColor = $(this).parents('.saleBtn').siblings('.saleSelect').children('option:selected').data('color');
            const selSize = $(this).parents('.saleBtn').siblings('.saleSelect').children('option:selected').data('size');
            const selPhoto = $(this).parents('.saleSELBox').siblings('a').find('img').attr('src');
            const selID = $(this).parents('figure').siblings('.item_info_id').find('.pd_ID').text().substr(1);
            const selSaleINFO = $(this).parents('figure').siblings('.item_info_id').find('.pd_saleinfo').text();
            const selName = $(this).parents('.saleSELBox').siblings('a').find('figcaption').find('.pd_name').text();
            const selPrice = $(this).parents('.saleSELBox').siblings('a').find('figcaption').find('.price-old').text().substr(3);

            console.log(selSaleINFO);

            var cartListArr = {
                'pdID': selID,
                'pdinfo': {
                    'pdColor': selColor,
                    'pdSize': selSize,
                    'pdPhoto': selPhoto,
                    'pdName': selName,
                    'pdPrice': selPrice,
                    'pdSaleINFO': selSaleINFO
                }
            };
            console.log(cartListArr);
            saleListDATA.push(JSON.stringify(cartListArr));









            // const removeList = localStorage.getItem("selectItem");

            $(this).val(selVal);

            //提醒尚未選取顏色尺寸
            if (selVal == 'noSel') {
                $(this).prop("checked", false);
                alert("請先選擇顏色/尺寸");
            }


            //選購動作判斷
            if ($(this).prop("checked")) {
                //選購:按鈕換字+option加上class=sel顏色-尺寸+加入清單
                const selBTN = '<span><i class="icon"> <u class="icon-i_okay"></u></i>已選購</span>';
                $(this).siblings('label').html(selBTN);
                $(this).parents('.saleBtn').siblings('.saleSelect').children('option:selected').addClass('sel' + selVal);

                addCartList();


            } else {
                //取消選購:按鈕換回原本的字與樣式+移除class=sel顏色-尺寸+移除清單
                $(this).siblings('label').html('<span>+ 選購</span>');
                $('.' + selVal).remove();
                $(this).parents('.saleBtn').siblings('.saleSelect').children('option:selected').removeClass('sel' + selVal);
                addToStorage();

            }

            //FN 印出暫存清單列表
            function addCartList() {
                const saleCartList = `<ul class="` + selVal + `">
                        <li class="item_pic">
                            <a title="" href=""><img src="` + selPhoto + `" alt="" title="">
                                <div class="item_soldout">
                                    已售完
                                </div>
                            </a>
                        </li>
                        <li class="item_info text-left">
                            <small class="item_info_id"><i class="tag_sale">特價品</i> #` + selID + `</small>
                            <span class="item_info_name"> <a title="" href="">` + selName + `</a></span>

                            <span class="item_info_other">color : ` + selColor + ` / SIZE: ` + selSize + `</span></li>
                        <li class="item_qty">1</li>
                        <li class="item_price"><span class="price-old">NTD.` + selPrice + `</span></li>
                        <li class="item_price_sub"><span class="price">NTD.` + Math.round(selPrice * (discountOFF / 100)) + `</span></li>
                        <li class="item_btn">
                            <span class="item_btn_delete">
                                <a title="" href="" class="btn btn-primary btn-sm">
                                    <i class="icon"><u class="icon-i_xx"></u></i>
                                    </a>
                                    </span>
                                    </li>
                    </ul>`;

                $('#saleCartList').append(saleCartList);
            }

            //統計

            totalQTY();

            //判斷選購商品是否超過優惠數量

            //刪除按鈕 移除清單一列並解除選購
            $('.item_btn_delete').on("click", function() {
                const selDelBox = $(this).parents('ul').attr('class');
                // alert(selDelBox);
                $(this).parents('ul').remove();
                $('.sel' + selDelBox).parent('.saleSelect').siblings('.saleBtn').children('input').prop("checked", false);
                $('.sel' + selDelBox).parent('.saleSelect').siblings('.saleBtn').children('label').html('<span>+ 選購</span>');
                $('.sel' + selDelBox).attr('class', '');
                totalQTY();
                // console.log('清單數量:' + totalItems);

                addToStorage();
                return false
            });



            //計算數量
            function totalQTY() {
                var num = $('#saleCartList ul').length - 1;
                // console.log('清單數量:' + num);
                const priceOld = 'price-old';
                const priceNew = 'price';
                // console.log('現在選購了' + totalItems + '件買' + discountCOMBO + '件打' + discountOFF + '折');
                // console.log('活動組合件數:' + arr.comboNum + '      折扣:' + arr.YAGDC);
                if (num < arr.comboNum) {
                    //數量不夠
                    $('.sale2Cart').removeClass('hasSale').html('未符合活動資格!');
                    totalSUM(priceOld);
                    $('.sale_qty').text(num);
                } else {
                    //數量足夠
                    $('.sale2Cart').addClass('hasSale').html('+ 加入購物車');
                    totalSUM(priceNew);
                    $('.sale_qty').text(num);
                }
            }

            //統計總價
            function totalSUM(classN) {
                var arrPPP = [];

                for (let i = 0; i < $('#saleCartList ul').length; i++) {
                    const element = $('#saleCartList ul').eq(i);
                    const numPPP = Number(element.find('.' + classN).text().substr(4));

                    arrPPP.push(numPPP);
                    // console.log(arrPPP);
                    var TOTALmun = 0;
                    for (let j = 0; j < arrPPP.length; j++) {
                        const element = arrPPP[j];
                        TOTALmun += element;
                        $('.sale_price').html(TOTALmun);
                    }
                }
                addToStorage();
            }



        });


        // console.log(saleListDATA);

        //把清單傳到暫存空間
        function addToStorage() {
            var cartListAll = $('#saleCartList').html();
            // localStorage.setItem(eventNUM, saleListDATA);
            localStorage.setItem(eventNUM, cartListAll);
            console.log(cartListAll);
        }


        // function pdSALEinfo(e) {

        //     if (e == false) {
        //         str = '<i class="tag_basic">正常品</i>';
        //     } else {
        //         str = '<i class="tag_sale">特價品</i>';
        //     }
        // }
    });
</script>

</html>